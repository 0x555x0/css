"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[95245],{38e3:function(e,t,l){function i(e){let{flashdeal_price:t,final_price_incl_tax:l,price_incl_tax:i}=e;return t>-1?t:l>-1?l:i>-1?i:0}function o(e){switch(e){case"th":default:return"th-TH";case"zh_cn":return"zh-CN";case"en":return"en-GB";case"lo":return"lo"}}function n(e){var t,l,i,o=0;for(var n of null!=e?e:[])(null==n?void 0:n.extra_services)!=null&&0!=(null!==(t=null==n?void 0:n.extra_services)&&void 0!==t?t:[]).length?(null==n?void 0:n.sell_in_kg)!=0?o+=1:o+=parseInt(null!==(l=n.qty)&&void 0!==l?l:0):(null==n?void 0:n.sell_in_kg)!=0?o+=1:o+=parseInt(null!==(i=n.qty)&&void 0!==i?i:0);return o}l.d(t,{Kd:function(){return o},LE:function(){return n},lE:function(){return i}})},95245:function(e,t,l){l.d(t,{dA:function(){return k},SJ:function(){return E},fL:function(){return N},Li:function(){return T},LL:function(){return x},wr:function(){return w},xO:function(){return q},QG:function(){return g},A4:function(){return S},sy:function(){return I}});var i=l(90898),o=l(29147);async function n(e){let{token:t,storeId:l,language:i}=e;return(0,o.Be)({path:"/composite/v4/cart/details",options:{headers:{Token:t,"Store-Id":l,Language:i}}})}async function r(e){let{token:t,storeId:l,language:i,requestBody:n}=e;return(0,o.mh)({path:"/composite/v4/cart/update-items",options:{data:n,headers:{Token:t,"Store-Id":l,Language:i}}})}async function a(e){let{token:t,storeId:l,requestBody:i}=e;return(0,o.mh)({path:"/composite/v4/cart-nopromo/update-items",options:{data:i,headers:{Token:t,"Store-Id":l}}})}async function d(e){let{token:t,storeId:l}=e;return(0,o.Y2)({path:"/composite/v4/cart/empty",options:{headers:{Token:t,"Store-Id":l}}})}async function u(e){let{token:t,storeId:l,language:i,requestBody:n}=e;return(0,o.mh)({path:"/composite/v4/cart/delete-items",options:{data:n,headers:{Token:t,"Store-Id":l,Language:i}}})}async function c(e){let{token:t,storeId:l,requestBody:i}=e;return(0,o.mh)({path:"/composite/v4/cart-nopromo/delete-items",options:{data:i,headers:{Token:t,"Store-Id":l}}})}async function s(e){let{token:t,storeId:l,requestBody:i}=e;return(0,o.SD)({path:"/composite/v4/cart/checkout-reduce-items",options:{data:i,headers:{Token:t,"Store-Id":l}}})}async function _(e){let{token:t,storeId:l,language:i,requestBody:n}=e;return(0,o.mh)({path:"/composite/v4/cart/update-items",options:{data:n,headers:{Token:t,"Store-Id":l,Language:i}}})}async function v(e){let{token:t,requestBody:l}=e;return(0,o.SD)({path:"/composite/v1/cart/validate-product-limit",options:{data:l,headers:{Token:t,"Content-Type":"application/json"}}})}var p=l(40053),m=l(73094),y=l(38e3);let f=!1;async function g(e){var t,l,i,o,r,a,d;let{storeId:u,language:c,cartDispatch:s}=e,_=(0,m.km)(),v=(null==_?void 0:null===(t=_.auth)||void 0===t?void 0:t.token)||null;if(v&&u){let e=await n({storeId:u,token:v,language:c});(null==e?void 0:e.code)==="success"&&(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.cart_detail)?localStorage.getItem("cart")?!0===await h({token:v,storeId:u,language:c,cartDispatch:s,onlineCart:null!==(r=null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(i=o.cart_detail)||void 0===i?void 0:i.cart_items)&&void 0!==r?r:[]})&&localStorage.removeItem("cart"):s((null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.cart_detail)?{type:"cart_success",payload:null==e?void 0:null===(d=e.data)||void 0===d?void 0:d.cart_detail}:{type:"cart_error"}):s({type:"cart_error"})}if(!v){let e=localStorage.getItem("cart");s(e?{type:"cart_success",payload:JSON.parse(e)}:{type:"cart_clear"})}}async function h(e){let{token:t,storeId:l,language:i,cartDispatch:o}=e,n=localStorage.getItem("cart");if(n){let e=JSON.parse(n);if(!l)return console.error("missing storeid: merge cart offline to online"),!1;{var r,a;let n=null==e?void 0:null===(r=e.cart_items)||void 0===r?void 0:r.map(e=>{var t;return{product_id:null==e?void 0:e.product_id,qty:null==e?void 0:e.qty,is_include_checkout:1,extra_services:null!==(t=null==e?void 0:e.extra_services)&&void 0!==t?t:null}}),d=await _({token:t,storeId:l,language:i,requestBody:{items:[{seller_id:1,warehouse_id:l,subcart_items:n}]}});return(null==d?void 0:d.code)==="success"?(localStorage.removeItem("cart"),o({type:"cart_success",payload:null==d?void 0:null===(a=d.data)||void 0===a?void 0:a.cart_detail}),!0):(console.error("fail: merge cart offline to online"),!1)}}}async function k(e){var t,l;let{storeId:o,product:n,qty:r=null,extraServiceData:d,cart:u,cartDispatch:c,trackingData:s}=e,_=(0,m.km)(),v=null==_?void 0:null===(t=_.auth)||void 0===t?void 0:t.token;if(v&&o){let e=null==u?void 0:u.cart_items.find(e=>(null==e?void 0:e.product_id)===(null==n?void 0:n.product_id)),t=e?J({storeId:o,product:e,qty:r,extraServiceData:d}):function(e){let{storeId:t,product:l,qty:i=null,extraServiceData:o}=e,n=i||((null==l?void 0:l.atc_qty)?null==l?void 0:l.atc_qty:(null==l?void 0:l.sell_in_kg)===1?null==l?void 0:l.sell_in_kg_step:1);return{items:[{seller_id:1,warehouse_id:t,subcart_items:[{product_id:+(null==l?void 0:l.product_id),is_include_checkout:1,qty:n,extra_services:o?[{id:null==o?void 0:o.id,qty:n}]:null}]}]}}({storeId:o,product:n,qty:r,extraServiceData:d}),i=await a({token:v,storeId:o,requestBody:t});(null==i?void 0:i.code)==="success"?(c({type:"cart_success",payload:null==i?void 0:null===(l=i.data)||void 0===l?void 0:l.cart_detail}),c({type:"toggle_animation"})):console.error("cant add product to cart"),s&&L("add",{...s,state:(null==i?void 0:i.code)==="success"?"success":"error"})}else{let e=null==u?void 0:u.cart_items.find(e=>(null==e?void 0:e.product_id)===(null==n?void 0:n.product_id));if(e)(function(e){let{product:t,productInCart:l,qty:i=null,extraServiceData:o,cartDispatch:n}=e,r=JSON.parse(localStorage.getItem("cart")),a=null==r?void 0:r.cart_items,d=null==a?void 0:a.map(e=>{if((null==e?void 0:e.product_id)!==(null==t?void 0:t.product_id))return e;{let n=i||((null==t?void 0:t.atc_qty)?null==t?void 0:t.atc_qty:(null==t?void 0:t.sell_in_kg)===1?null==t?void 0:t.sell_in_kg_step:1),r=[...l.extra_services,{...o,qty:n}],a=(null==e?void 0:e.qty)+n;return{...l,extra_services:r,qty:parseFloat(a.toFixed(3))}}}),u={...r,cart_items:d};console.log({newCart:d});let c=b(u);localStorage.setItem("cart",JSON.stringify(c)),n({type:"cart_success",payload:c}),n({type:"toggle_animation"})})({product:n,qty:r,productInCart:e,extraServiceData:d,cartDispatch:c}),s&&L("add",{...s,state:"success"});else{let e=function(e){let{product:t,qty:l=null,extraServiceData:i}=e;return{product_id:t.product_id,sku:t.sku,name:t.name,name_en:t.name,max_qty:null==t?void 0:t.max_qty,unit:t.unit,unit_en:t.unit_en,thumbnail_image:t.thumbnail_image,is_include_checkout:1,price_sales:(null==t?void 0:t.price_sales)?null==t?void 0:t.price_sales:(0,y.lE)({flashdeal_price:t.flashdeal_price,final_price_incl_tax:t.final_price_incl_tax,price_incl_tax:t.price_incl_tax}),price_incl_tax:t.price_incl_tax,final_price_incl_tax:t.final_price_incl_tax,flashdeal_price:t.flashdeal_price,qty:l||((null==t?void 0:t.sell_in_kg)===1?null==t?void 0:t.sell_in_kg_step:1),sell_in_kg:null==t?void 0:t.sell_in_kg,sell_in_kg_step:null==t?void 0:t.sell_in_kg_step,cart_type:"offline",extra_services:i?[{...i,qty:l||((null==t?void 0:t.sell_in_kg)===1?null==t?void 0:t.sell_in_kg_step:1)}]:null}}({product:n,qty:r,extraServiceData:d}),t=localStorage.getItem("cart"),l={};t?null==(l=JSON.parse(t))||l.cart_items.push(e):l={...i.E3,cart_items:[e]};let o=b(l);localStorage.setItem("cart",JSON.stringify(o)),c({type:"cart_success",payload:o}),c({type:"toggle_animation"}),s&&L("add",{...s,state:"success"})}}}async function q(e){var t,l,i,o,n;let{storeId:r,language:a,product:d,cartDispatch:c}=e,s=(0,m.km)(),_=null==s?void 0:null===(t=s.auth)||void 0===t?void 0:t.token;if(!f&&_&&r){f=!0,c({type:"cart_loading"});let e=function(e){var t;let{storeId:l,product:i}=e;return{items:[{seller_id:1,warehouse_id:+(null==i?void 0:i.warehouse_id),subcart_items:[{product_id:+(null==i?void 0:i.product_id),cart_item_id:+(null==i?void 0:i.cart_item_id),is_include_checkout:1,qty:null==i?void 0:i.qty,extra_services:(null==i?void 0:i.is_extra_service)?[{id:null==i?void 0:i.is_extra_service_id,qty:null==i?void 0:i.qty}]:null}]}]}}({storeId:r,product:d}),t=await u({storeId:r,token:null==s?void 0:null===(l=s.auth)||void 0===l?void 0:l.token,language:a,requestBody:e});(null==t?void 0:t.code)==="success"?(f=!1,c({type:"cart_success",payload:null==t?void 0:null===(i=t.data)||void 0===i?void 0:i.cart_detail})):(f=!1,c({type:"cart_error"}))}else{let e=localStorage.getItem("cart");if(e){let t=JSON.parse(e);if(null==d?void 0:d.is_extra_service){let e=null==t?void 0:null===(o=t.cart_items)||void 0===o?void 0:o.map(e=>{if((null==e?void 0:e.product_id)!==(null==d?void 0:d.product_id))return e;{var t;let l=null==e?void 0:null===(t=e.extra_services)||void 0===t?void 0:t.filter(e=>(null==e?void 0:e.id)!==(null==d?void 0:d.is_extra_service_id));return(null==l?void 0:l.length)>0?{...e,extra_services:l,qty:l.reduce((e,t)=>e+(null==t?void 0:t.qty),0)}:{...e,qty:0}}}).filter(e=>(null==e?void 0:e.qty)>0),l=b({...t,cart_items:e});localStorage.setItem("cart",JSON.stringify(l)),c({type:"cart_success",payload:l})}else{let e=null==t?void 0:null===(n=t.cart_items)||void 0===n?void 0:n.filter(e=>d.product_id!==e.product_id),l=b({...t,cart_items:e});localStorage.setItem("cart",JSON.stringify(l)),c({type:"cart_success",payload:l})}}}}async function x(e){var t,l;let{storeId:i,cartDispatch:o}=e,n=(0,m.km)();localStorage.getItem("cart")&&localStorage.removeItem("cart"),(null==n?void 0:null===(t=n.auth)||void 0===t?void 0:t.token)&&i&&await d({token:null==n?void 0:null===(l=n.auth)||void 0===l?void 0:l.token,storeId:i}),o({type:"cart_clear"})}async function S(e){let{storeId:t,language:l,product:i,cartDispatch:o,trackingData:n,page:d}=e;if(!f){var u,c;let e=(0,m.km)(),s=null==e?void 0:null===(u=e.auth)||void 0===u?void 0:u.token;if(s&&t){let e;let u=J({storeId:t,product:i});f=!0,o({type:"cart_loading"}),e="cart_modal"===d?await r({token:s,storeId:t,language:l,requestBody:u}):await a({token:s,storeId:t,requestBody:u}),f=!1,(null==e?void 0:e.code)==="success"?(o({type:"cart_success",payload:null==e?void 0:null===(c=e.data)||void 0===c?void 0:c.cart_detail}),o({type:"toggle_animation"})):console.error("can't increase product"),n&&L("increase",{...n,state:(null==e?void 0:e.code)==="success"?"success":"error"})}else O({method:"plus",product:i,cartDispatch:o}),n&&L("increase",{...n,state:"success"})}}async function w(e){let{storeId:t,language:l,product:i,qty:o=null,cartDispatch:n,trackingData:r,page:a}=e;if(!f){var d,s;let e=(0,m.km)(),_=null==e?void 0:null===(d=e.auth)||void 0===d?void 0:d.token;if(_&&t){let e;let d=function(e){var t;let{storeId:l,product:i,qty:o=null}=e,n=o||((null==i?void 0:i.atc_qty)?null==i?void 0:i.atc_qty:(null==i?void 0:i.sell_in_kg)===1?null==i?void 0:i.sell_in_kg_step:1);return{items:[{seller_id:1,warehouse_id:+(null==i?void 0:i.warehouse_id),subcart_items:[{product_id:+(null==i?void 0:i.product_id),cart_item_id:+(null==i?void 0:i.cart_item_id),is_include_checkout:1,qty:n,extra_services:(null==i?void 0:i.is_extra_service)?[{id:null==i?void 0:i.is_extra_service_id,qty:n}]:null}]}]}}({storeId:t,product:i,qty:o});f=!0,n({type:"cart_loading"}),e="cart_modal"===a?await u({storeId:t,token:_,language:l,requestBody:d}):await c({storeId:t,token:_,requestBody:d}),f=!1,(null==e?void 0:e.code)==="success"?(n({type:"cart_success",payload:null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.cart_detail}),n({type:"toggle_animation"})):console.error("can't decrease product"),r&&L("decrease",{...r,state:(null==e?void 0:e.code)==="success"?"success":"error"})}else O({method:"minus",product:i,cartDispatch:n}),r&&L("decrease",{...r,state:"success"})}}async function I(e){let{token:t,storeId:l,language:i,cartDispatch:o,reorderItems:n}=e;if(!(n.length>0)||!l)return!1;{var r;let e=await _({token:t,storeId:l,language:i,requestBody:{items:[{seller_id:1,warehouse_id:l,subcart_items:n}]}});return(null==e?void 0:e.code)!=="success"?(console.error("fail: reorder"),!1):(o({type:"cart_success",payload:null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.cart_detail}),!0)}}function b(e){let t=0;if(e){var l;t=null==e?void 0:null===(l=e.cart_items)||void 0===l?void 0:l.reduce((e,t)=>e+t.qty*(0,y.lE)({flashdeal_price:t.flashdeal_price,final_price_incl_tax:t.final_price_incl_tax,price_incl_tax:t.price_incl_tax}),0)}return{...e,pricing_summary:{subtotal_price:t,delivery_cost:0,delivery_discount:0,price_discount:0,total_price:t}}}async function N(e){let{token:t,storeId:l,adjustItem:i}=e;if((null==i?void 0:i.length)>0){let e=(null==i?void 0:i.reduce((e,t)=>e.includes(t.warehouse_id)?e:[...e,t.warehouse_id],[])).map(e=>{let t=null==i?void 0:i.filter(t=>{var l;return(null==t?void 0:t.warehouse_id)===e&&(null==t?void 0:null===(l=t.adjust_info)||void 0===l?void 0:l.qty)}).map(e=>{var t,l;let i=function(e){var t,l,i,o;if(!((null==e?void 0:null===(t=e.extra_services)||void 0===t?void 0:t.length)>0))return[];{let t=null==e?void 0:null===(l=e.extra_services)||void 0===l?void 0:l.sort((e,t)=>(null==e?void 0:e.qty)>(null==t?void 0:t.qty)?1:-1),n=null==e?void 0:null===(o=e.check_result)||void 0===o?void 0:null===(i=o.stock_error)||void 0===i?void 0:i.missing_qty;return null==t?void 0:t.map(e=>{if(n>0){let t=(null==e?void 0:e.qty)>n?n:null==e?void 0:e.qty;return n-=t,{...e,qty:t}}}).filter(e=>e)}}(e);return{product_id:null==e?void 0:e.product_id,cart_item_id:null==e?void 0:e.cart_item_id,qty:null==e?void 0:null===(l=e.check_result)||void 0===l?void 0:null===(t=l.stock_error)||void 0===t?void 0:t.missing_qty,extra_services:(null==i?void 0:i.length)>0?i:[],is_include_checkout:1}});return{seller_id:1,warehouse_id:e,subcart_items:t}});return await s({storeId:l,token:t,requestBody:{items:e}})}}function O(e){let{method:t,product:l,cartDispatch:i}=e,o=localStorage.getItem("cart");if(o){var n,r;let e=JSON.parse(o),a=null==e?void 0:null===(r=e.cart_items)||void 0===r?void 0:null===(n=r.map(e=>{if(l.product_id===e.product_id){var i,o;let n=(null==l?void 0:l.atc_qty)?null==l?void 0:l.atc_qty:(null==l?void 0:l.sell_in_kg)===1?null==l?void 0:l.sell_in_kg_step:1;if("plus"===t)return{...e,qty:e.qty+n,extra_services:(null==l?void 0:l.is_extra_service)?null==l?void 0:null===(i=l.extra_services)||void 0===i?void 0:i.map(e=>(null==l?void 0:l.is_extra_service_id)===(null==e?void 0:e.id)?{...e,qty:(null==e?void 0:e.qty)+n}:e):null};if("minus"===t)return{...e,qty:e.qty-n,extra_services:(null==l?void 0:l.is_extra_service)?null==l?void 0:null===(o=l.extra_services)||void 0===o?void 0:o.map(e=>(null==l?void 0:l.is_extra_service_id)!==(null==e?void 0:e.id)?e:(null==e?void 0:e.qty)-n>0?{...e,qty:(null==e?void 0:e.qty)-n}:{...e,qty:0}).filter(e=>(null==e?void 0:e.qty)>Number.EPSILON):null}}return e}))||void 0===n?void 0:n.filter(e=>(null==e?void 0:e.qty)>0&&(null==e?void 0:e.qty)>Number.EPSILON),d=b({...e,cart_items:a});localStorage.setItem("cart",JSON.stringify(d)),i({type:"cart_success",payload:d}),i({type:"toggle_animation"})}}function J(e){var t;let{storeId:l,product:i,qty:o=null,extraServiceData:n}=e,r=o||((null==i?void 0:i.atc_qty)?null==i?void 0:i.atc_qty:(null==i?void 0:i.sell_in_kg)===1?null==i?void 0:i.sell_in_kg_step:1);return{items:[{seller_id:1,warehouse_id:+(null==i?void 0:i.warehouse_id),subcart_items:[{product_id:+(null==i?void 0:i.product_id),is_include_checkout:1,qty:r,extra_services:(null==i?void 0:i.is_extra_service)&&!n?[{id:null==i?void 0:i.is_extra_service_id,qty:r}]:(null==i?void 0:i.is_extra_service)&&n?[{id:null==n?void 0:n.id,qty:r}]:null}]}]}}function L(e,t){null==t||t.trackFunc({action:(null==t?void 0:t.action)?null==t?void 0:t.action:"decrease"===e?"remove_from_cart":"add_to_cart",name:(null==t?void 0:t.name)?null==t?void 0:t.name:"decrease"===e?"remove_from_cart".concat((null==t?void 0:t.feature)==="widget_smart_recommend"?"_smart_product":""):"add_to_cart".concat((null==t?void 0:t.feature)==="widget_smart_recommend"?"_smart_product":""),logId:function(e,t){let l="A"===(0,p.Z)(),i=null==t?void 0:t.section,o=null==t?void 0:t.feature,n=null==t?void 0:t.logId;return n||(n=("header"===i&&"search"===o||"search_result"===i&&"search"===o||"search_result"===i&&"search_result"===o)&&l?"decrease"===e?"1000600800":"1000500800":"decrease"===e?"1000600801":"1000500801"),n}(e,t),product:null==t?void 0:t.product,...(null==t?void 0:t.category)&&{category:null==t?void 0:t.category},...(null==t?void 0:t.section)&&{section:null==t?void 0:t.section},...(null==t?void 0:t.feature)&&{feature:null==t?void 0:t.feature},...(null==t?void 0:t.state)&&{state:null==t?void 0:t.state},...(null==t?void 0:t.label)&&{label:null==t?void 0:t.label},...(null==t?void 0:t.value)&&{value:null==t?void 0:t.value}})}async function T(e){var t,l;let{requestBody:i}=e,o=(0,m.km)(),n=null==o?void 0:null===(t=o.auth)||void 0===t?void 0:t.token,r=await v({token:n,requestBody:i});return null==r?void 0:null===(l=r.data)||void 0===l?void 0:l.product_limit}async function E(e){var t,l,i,o,n,r,a,d,c,s;let{storeId:_,language:v,cartDispatch:p,product_limits:y}=e,f=(0,m.km)(),g=null==f?void 0:null===(t=f.auth)||void 0===t?void 0:t.token,h=[];for(let e=0;e<y.length;e++){let t=y[e];console.log("_productLimit",t);let l=(null==t?void 0:null===(o=t.cart_items)||void 0===o?void 0:o.qty)-t.remaining_qty;h.push({product_id:+(null==t?void 0:null===(n=t.cart_items)||void 0===n?void 0:n.product_id),cart_item_id:+(null==t?void 0:null===(r=t.cart_items)||void 0===r?void 0:r.cart_item_id),is_include_checkout:1,qty:l,extra_services:null})}let k={items:[{seller_id:1,warehouse_id:+(null===(i=y[0])||void 0===i?void 0:null===(l=i.cart_items)||void 0===l?void 0:l.warehouse_id),subcart_items:h}]},q=await u({storeId:_,token:g,language:v,requestBody:k});return(null==q?void 0:q.code)==="success"?(p({type:"cart_success",payload:null==q?void 0:null===(d=q.data)||void 0===d?void 0:d.cart_detail}),p({type:"toggle_animation"}),{code:null==q?void 0:q.code,cart_items:null==q?void 0:null===(s=q.data)||void 0===s?void 0:null===(c=s.cart_detail)||void 0===c?void 0:c.cart_items}):(console.error("can't decrease product"),{code:null==q?void 0:q.code,cart_items:[]})}}}]);